<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Ads.txt Line Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-found { color: #16a34a; font-weight: 600; }
        .status-not-found { color: #ca8a04; font-weight: 600; }
        .status-file-missing { color: #ea580c; font-weight: 600; }
        .status-error { color: #dc2626; font-weight: 600; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl w-full">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <div class="text-center mb-6">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Bulk Ads.txt Line Checker</h1>
                <p class="text-gray-500 mt-2">Check for a single ads.txt line across multiple websites.</p>
            </div>
            
            <!-- Input Section -->
            <div class="space-y-6 mb-6">
                <div>
                    <label for="adsLineInput" class="block text-sm font-medium text-gray-700 mb-1">1. Ads.txt Line to Find</label>
                    <input type="text" id="adsLineInput" placeholder="google.com, pub-12345, DIRECT, f08c47fec0942fa0" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="websitesList" class="block text-sm font-medium text-gray-700 mb-1">2. Websites (one per line)</label>
                    <textarea id="websitesList" rows="6" placeholder="example.com&#10;anothersite.org&#10;webaudit.co" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
            </div>

            <div class="flex flex-col items-center justify-center mb-6">
                 <label for="appAdsToggle" class="flex items-center cursor-pointer mb-4">
                    <input type="checkbox" id="appAdsToggle" class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                    <span class="ml-2 text-gray-700">Check for app-ads.txt</span>
                </label>
                <div id="controls" class="flex items-center gap-4">
                    <button id="checkButton" class="bg-blue-600 text-white font-semibold px-8 py-3 rounded-lg hover:bg-blue-700 flex items-center justify-center">
                        <i class="fas fa-play mr-2"></i>Start Scan
                    </button>
                    <button id="pauseButton" class="bg-yellow-500 text-white font-semibold px-8 py-3 rounded-lg hover:bg-yellow-600 hidden items-center justify-center">
                        <i class="fas fa-pause mr-2"></i>Pause
                    </button>
                    <button id="resumeButton" class="bg-green-500 text-white font-semibold px-8 py-3 rounded-lg hover:bg-green-600 hidden items-center justify-center">
                        <i class="fas fa-play mr-2"></i>Resume
                    </button>
                    <button id="cancelButton" class="bg-gray-600 text-white font-semibold px-8 py-3 rounded-lg hover:bg-gray-700 hidden items-center justify-center">
                        <i class="fas fa-stop mr-2"></i>Cancel
                    </button>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div id="progressContainer" class="hidden my-4">
                <p id="progressLabel" class="text-center text-sm text-gray-600 mb-1">Checking...</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsContainer" class="hidden mt-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="resultsTitle" class="text-2xl font-bold text-gray-800">Results</h2>
                     <button id="downloadCsvBtn" class="bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition text-sm flex items-center">
                        <i class="fas fa-download mr-2"></i>Download CSV
                    </button>
                </div>
                <div class="overflow-x-auto bg-white rounded-lg shadow max-h-96">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Website</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Results will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Error Message Display -->
            <div id="errorContainer" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert"></div>
        </div>
    </div>

    <script>
        // --- Element Selection ---
        const checkButton = document.getElementById('checkButton'),
            pauseButton = document.getElementById('pauseButton'),
            resumeButton = document.getElementById('resumeButton'),
            cancelButton = document.getElementById('cancelButton'),
            adsLineInput = document.getElementById('adsLineInput'),
            websitesList = document.getElementById('websitesList'),
            appAdsToggle = document.getElementById('appAdsToggle'),
            resultsContainer = document.getElementById('resultsContainer'),
            resultsTableBody = document.getElementById('resultsTableBody'),
            resultsTitle = document.getElementById('resultsTitle'),
            errorContainer = document.getElementById('errorContainer'),
            progressContainer = document.getElementById('progressContainer'),
            progressBar = document.getElementById('progressBar'),
            progressLabel = document.getElementById('progressLabel'),
            downloadCsvBtn = document.getElementById('downloadCsvBtn');

        // --- State Management ---
        let state = 'idle'; // idle, running, paused, cancelled, complete
        let sitesQueue = [];
        let resultsForCSV = [];
        const SCAN_DELAY_MS = 2000; // 2-second delay between requests

        /** Resets UI state before a new check. */
        function resetState() {
            resultsContainer.classList.add('hidden');
            errorContainer.classList.add('hidden');
            progressContainer.classList.add('hidden');
            resultsTableBody.innerHTML = '';
            resultsForCSV = [];
            sitesQueue = [];
            state = 'idle';
            updateUIForState();
        }

        /** Updates buttons and inputs based on the current state */
        function updateUIForState() {
            checkButton.classList.toggle('hidden', state !== 'idle');
            pauseButton.classList.toggle('hidden', state !== 'running');
            resumeButton.classList.toggle('hidden', state !== 'paused');
            cancelButton.classList.toggle('hidden', state === 'idle' || state === 'complete');
            adsLineInput.disabled = state !== 'idle';
            websitesList.disabled = state !== 'idle';
        }

        /** Displays a validation or system error message. */
        function showError(message) {
            errorContainer.textContent = message;
            errorContainer.classList.remove('hidden');
        }
        
        /** Normalizes a line from an ads.txt file for comparison. */
        function normalizeLine(line) {
            return line.replace(/\s/g, '').toLowerCase();
        }

        /** Creates a delay. */
        const delay = ms => new Promise(res => setTimeout(res, ms));

        /** Fetches a URL with retry logic. */
        async function fetchWithRetries(url, retries = 2, backoff = 500) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (response.status === 429 || response.status >= 500) {
                         throw new Error(`Server error: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await delay(backoff * Math.pow(2, i));
                }
            }
        }

        /** Processes a single website check. */
        async function processSite(site, normalizedLineToFind) {
             try {
                 const domain = new URL('https://' + site.replace(/^https?:\/\//, '')).hostname;
                 const fileType = appAdsToggle.checked ? 'app-ads.txt' : 'ads.txt';
                 const targetUrl = `https://${domain}/${fileType}`;
                 const proxyUrl = `https://thingproxy.freeboard.io/fetch/${targetUrl}`;
                 
                 const response = await fetchWithRetries(proxyUrl);
                 
                 if (!response.ok) {
                    if (response.status === 404) {
                        return { site, status: 'File Does Not Exist (404)', statusClass: 'status-file-missing' };
                    }
                    throw new Error(`HTTP error: ${response.status}`);
                 }

                 const text = await response.text();
                 const found = text.split('\n').some(line => normalizeLine(line) === normalizedLineToFind);
                 
                 return found
                    ? { site, status: 'Found', statusClass: 'status-found' }
                    : { site, status: 'Not Found in File', statusClass: 'status-not-found' };

             } catch (error) {
                 console.error(`Error checking ${site}:`, error);
                 return { site, status: 'Fetch Error', statusClass: 'status-error' };
             }
        }

        /** Main function to run the scanner. */
        async function runScanner() {
            const lineToFind = adsLineInput.value.trim();
            const websites = websitesList.value.split('\n').map(w => w.trim()).filter(w => w);

            if (!lineToFind || websites.length === 0) {
                showError('Please provide both an ads.txt line and a list of websites.');
                return;
            }
            
            resetState();
            state = 'running';
            updateUIForState();
            progressContainer.classList.remove('hidden');
            resultsContainer.classList.remove('hidden');

            sitesQueue = [...websites];
            const totalSites = sitesQueue.length;
            const normalizedLineToFind = normalizeLine(lineToFind);
            
            for (let i = 0; i < totalSites; i++) {
                // Handle pausing
                while (state === 'paused') {
                    await delay(500); // Check every half second if we should resume
                }
                // Handle cancellation
                if (state === 'cancelled') {
                    progressLabel.textContent = `Scan cancelled after ${i} checks.`;
                    break;
                }

                const site = sitesQueue[i];
                progressLabel.textContent = `Checking ${i + 1} of ${totalSites}: ${site}...`;
                
                const result = await processSite(site, normalizedLineToFind);

                const row = `<tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${result.site}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${result.statusClass}">${result.status}</td>
                </tr>`;
                resultsTableBody.insertAdjacentHTML('beforeend', row);
                resultsForCSV.push({ website: result.site, status: result.status });
                
                progressBar.style.width = `${((i + 1) / totalSites) * 100}%`;
                
                // Don't delay after the last item
                if (i < totalSites - 1) {
                    await delay(SCAN_DELAY_MS);
                }
            }

            if (state !== 'cancelled') {
                state = 'complete';
                progressLabel.textContent = `Scan complete. Checked ${totalSites} websites.`;
                resultsTitle.textContent = `Results (${totalSites} sites)`;
            }
            updateUIForState();
        }

        function downloadCSV() {
            if (resultsForCSV.length === 0) return;
            let csvContent = '"Website","Status"\n';
            resultsForCSV.forEach(r => { csvContent += `"${r.website}","${r.status}"\n`; });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "bulk_line_check_results.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- Event Listeners ---
        checkButton.addEventListener('click', runScanner);
        pauseButton.addEventListener('click', () => {
            state = 'paused';
            updateUIForState();
            progressLabel.textContent += ' (Paused)';
        });
        resumeButton.addEventListener('click', () => {
            state = 'running';
            updateUIForState();
        });
        cancelButton.addEventListener('click', () => {
            state = 'cancelled';
            updateUIForState();
        });
        downloadCsvBtn.addEventListener('click', downloadCSV);

    </script>
</body>
</html>
